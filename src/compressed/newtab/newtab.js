const Debugger={log:e=>{this.debugging&&console.log(e)},error:e=>{this.debugging&&console.error(e)},warn:e=>{this.debugging&&console.warn(e)},debugging:!1,debugging:{enable:function(){this.debugging=!0},disable:function(){this.debugging=!1}}};async function fetchSettingsAndGroups(){if("undefined"!=typeof chrome&&chrome.storage&&chrome.storage.sync){Debugger.log("Using Chrome storage API");const{settings:e,groups:t,groupsLocation:o}=await chrome.storage.sync.get(["settings","groups","groupsLocation"]);let n=t;if("local"===o){n=(await chrome.storage.local.get(["groups"])).groups||[]}return{settings:e||defaultSettings,groups:n||[]}}return{settings:JSON.parse(localStorage.getItem("settings")||"null")||defaultSettings,groups:JSON.parse(localStorage.getItem("groups")||"[]")}}async function initializePage(){try{const e=measureLoadTime("Page initialization"),[t,o]=await Promise.all([getFromStorage("settings"),getFromStorage("groups")]);applyTheme(),initializeSearch(),requestAnimationFrame((()=>{Promise.all([renderGroups(o),initializeHeaderLinks(),initializeAppsDropdown()]).then((()=>{setTimeout((()=>{loadWidgets(),setupImageDrop()}),100),e()}))}))}catch(e){Debugger.error("Error initializing:",e)}}function measureLoadTime(e){const t=performance.now();return()=>{const o=performance.now()-t;Debugger.log(`${e} took ${o}ms`)}}const endMeasure=measureLoadTime("Group loading"),container=document.getElementById("groups-container"),searchContainer=document.getElementById("search-container"),searchForm=document.getElementById("search-form"),searchInput=document.getElementById("search-input"),searchIcon=document.getElementById("search-icon"),defaultSettings={theme:"light",useCustomBackground:!1,backgroundURL:"",backgroundImage:null,showSearch:!0,searchEngine:"google",searchBarPosition:{x:540,y:360},useGlassBackground:!0,fontSize:16,groupScale:100,customColors:{primary:"#457b9d",secondary:"#a8dadc",accent:"#e63946",text:"#1d3557",background:"#f1faee"},headerLinks:[{name:"Gmail",url:"https://mail.google.com"},{name:"Photos",url:"https://photos.google.com"},{name:"Search Labs",url:"https://labs.google.com"}],apps:[{name:"Account",icon:"https://www.gstatic.com/images/branding/product/1x/avatar_square_blue_32dp.png",url:"https://myaccount.google.com/"},{name:"Search",icon:"https://www.gstatic.com/images/branding/product/1x/googleg_32dp.png",url:"https://www.google.com/"},{name:"Maps",icon:"https://maps.gstatic.com/mapfiles/maps_lite/favicon_maps.ico",url:"https://maps.google.com/"},{name:"YouTube",icon:"https://www.youtube.com/s/desktop/1c3bfd26/img/favicon_32x32.png",url:"https://youtube.com/"},{name:"Play",icon:"https://www.gstatic.com/images/branding/product/1x/play_round_32dp.png",url:"https://play.google.com/"},{name:"Gmail",icon:"https://ssl.gstatic.com/ui/v1/icons/mail/rfr/gmail.ico",url:"https://mail.google.com/"},{name:"Drive",icon:"https://ssl.gstatic.com/images/branding/product/1x/drive_32dp.png",url:"https://drive.google.com/"},{name:"Calendar",icon:"https://ssl.gstatic.com/calendar/images/favicon_v2021_32.ico",url:"https://calendar.google.com/"},{name:"Photos",icon:"https://ssl.gstatic.com/images/branding/product/1x/photos_32dp.png",url:"https://photos.google.com/"}]};let currentSettings={...defaultSettings};function calculatePosition(e,t){const o=window.innerWidth,n=window.innerHeight;let r,s;if("string"==typeof e&&e.endsWith("%"))r=parseFloat(e)/100;else{const t=parseFloat(e);r=isNaN(t)?.5:t/o}if("string"==typeof t&&t.endsWith("%"))s=parseFloat(t)/100;else{const e=parseFloat(t);s=isNaN(e)?.5:e/n}r=Math.max(0,Math.min(1,r)),s=Math.max(0,Math.min(1,s));return{x:r*o,y:s*n,percentX:r,percentY:s}}const newGroup={stack:function(e,t,o,n){let r=document.createElement("div");if(r.classList.add("group"),r.classList.add("stack"),!1!==currentSettings.useGlassBackground&&r.classList.add("glass-background"),n&&n.trim().length>0){let e=document.createElement("div");e.classList.add("group-header"),e.textContent=n,r.appendChild(e)}let s=document.createElement("ul");e.forEach((async e=>{let t=getFavicon(e.url);s.innerHTML+=newLink.stack(e.title,e.url,t)})),r.appendChild(s);const a=calculatePosition(t,o);return r.style.position="absolute",r.style.top=100*a.percentY+"%",r.style.left=100*a.percentX+"%",r.style.transform="translate(-50%, -50%)",r},grid:function(e,t,o,n,r,s){let a=document.createElement("div");if(a.classList.add("group"),!1!==currentSettings.useGlassBackground&&a.classList.add("glass-background"),s&&s.trim().length>0){let e=document.createElement("div");e.classList.add("group-header"),e.textContent=s,a.appendChild(e)}let c=document.createElement("div");c.classList.add("grid"),e.forEach((async e=>{let t=getFavicon(e.url);c.innerHTML+=newLink.grid(e.title,e.url,t)})),a.appendChild(c);const i=calculatePosition(t,o);return a.style.position="absolute",a.style.top=100*i.percentY+"%",a.style.left=100*i.percentX+"%",a.style.transform="translate(-50%, -50%)",c.style.display="grid",c.style.gridTemplateColumns=`repeat(${r}, 1fr)`,c.style.gridTemplateRows=`repeat(${n}, 1fr)`,c.style.gridGap="10px",a},single:function(e,t,o,n){let r=document.createElement("div");if(!1!==currentSettings.useGlassBackground&&r.classList.add("glass-background"),n&&n.trim().length>0){let e=document.createElement("div");e.classList.add("group-header"),e.textContent=n,r.appendChild(e)}let s=getFavicon(e.url);r.innerHTML+=newLink.single(e.title,e.url,s),r.classList.add("group"),r.classList.add("single");const a=calculatePosition(t,o);return r.style.position="absolute",r.style.top=100*a.percentY+"%",r.style.left=100*a.percentX+"%",r.style.transform="translate(-50%, -50%)",r}},newLink={stack:function(e,t,o){return`\n            <li class="link-stack">\n                <a href="${t}"><img class="link-image" src="${o}"/>${e}</a>\n            </li>\n        `},grid:function(e,t,o){return`\n            <a href="${t}"class="link-grid">\n                <img class="link-image" src="${o}"/>\n                <span class="grid-link-title">${e}</span>\n            </a>\n        `},single:function(e,t,o){return`\n            <a href="${t}" class="link-single">\n                <img src="${o}"/>\n                <span>${e}</span>\n            </a>\n        `}};async function lazyRenderGroups(e){const t=document.getElementById("groups-container");t.innerHTML="";const o=e.map((e=>{const o="string"==typeof e.x&&e.x.endsWith("%")?e.x:parseFloat(e.x)/window.innerWidth*100+"%",n=createGroupPlaceholder({styleTop:"string"==typeof e.y&&e.y.endsWith("%")?e.y:parseFloat(e.y)/window.innerHeight*100+"%",styleLeft:o});return t.appendChild(n),n})),n=()=>{o.forEach(((t,o)=>{renderGroupContent(t,e[o])}))};"requestIdleCallback"in window?requestIdleCallback(n,{timeout:200}):requestAnimationFrame(n)}function deferNonCritical(){const e=()=>{loadWidgets(),setupImageDrop()};"requestIdleCallback"in window?requestIdleCallback(e):setTimeout(e,200)}function initializeSearch(){const e={google:{url:"https://www.google.com/search?q=",icon:"https://www.google.com/favicon.ico"},bing:{url:"https://www.bing.com/search?q=",icon:"https://www.bing.com/favicon.ico"},duckduckgo:{url:"https://duckduckgo.com/?q=",icon:"https://duckduckgo.com/favicon.ico"},yahoo:{url:"https://search.yahoo.com/search?p=",icon:"https://www.yahoo.com/favicon.ico"}},t=e[currentSettings.searchEngine]||e.google;if(searchIcon.src=t.icon,searchForm.addEventListener("submit",(function(e){e.preventDefault();const o=searchInput.value.trim();o&&(window.location.href=t.url+encodeURIComponent(o))})),currentSettings.searchBarPosition){const e=calculatePosition(currentSettings.searchBarPosition.x,currentSettings.searchBarPosition.y);searchContainer.style.top=100*e.percentY+"%",searchContainer.style.left=100*e.percentX+"%",searchContainer.style.transform="translate(-50%, -50%)"}searchContainer.style.display=currentSettings.showSearch?"block":"none"}function applyGlassBackground(){const e=!1!==currentSettings.useGlassBackground,t=document.querySelector(".chrome-header");t&&(e?t.classList.add("glass-background"):t.classList.remove("glass-background"));const o=document.querySelector(".search-form"),n=document.querySelector(".search-container");o&&(e?(n.classList.add("glass-background"),o.classList.add("glass-background")):(n.classList.remove("glass-background"),o.classList.remove("glass-background")));const r=document.querySelector(".apps-dropdown");r&&(e?r.classList.add("glass-background"):r.classList.remove("glass-background"));const s=document.querySelector(".apps-grid");s&&(e?s.classList.add("glass-background"):s.classList.remove("glass-background"));document.querySelectorAll(".group").forEach((t=>{e?t.classList.add("glass-background"):t.classList.remove("glass-background")}))}function applyTheme(){Array.from(document.body.classList).filter((e=>e.startsWith("theme-"))).forEach((e=>document.body.classList.remove(e)));const e=currentSettings.theme||"light",t=e.split("-")[0],o=new Set(["dark","midnight","emerald","slate","deep","nord","cyber"]);if(e.startsWith("custom-")||"custom"===e)if("custom"===e){const e=currentSettings.customColors||{primary:"#457b9d",secondary:"#a8dadc",accent:"#e63946",text:"#1d3557",background:"#f1faee"};document.documentElement.style.setProperty("--all-background-color",e.background),document.documentElement.style.setProperty("--group-background-color",e.secondary),document.documentElement.style.setProperty("--text-color",e.text),document.documentElement.style.setProperty("--accent-color",e.accent),document.documentElement.style.setProperty("--primary-color",e.primary);const t=isColorDark(e.primary);document.documentElement.style.setProperty("--contrast-text-color",t?"#ffffff":"#000000")}else{const t=currentSettings.customThemes&&currentSettings.customThemes.find((t=>t.id===e));if(t){document.documentElement.style.setProperty("--all-background-color",t.background),document.documentElement.style.setProperty("--group-background-color",t.secondary),document.documentElement.style.setProperty("--text-color",t.text),document.documentElement.style.setProperty("--accent-color",t.accent),document.documentElement.style.setProperty("--primary-color",t.primary);const e=isColorDark(t.primary);document.documentElement.style.setProperty("--contrast-text-color",e?"#ffffff":"#000000")}else document.documentElement.style.setProperty("--all-background-color","#f1faee"),document.documentElement.style.setProperty("--group-background-color","#a8dadc"),document.documentElement.style.setProperty("--text-color","#1d3557"),document.documentElement.style.setProperty("--accent-color","#e63946"),document.documentElement.style.setProperty("--primary-color","#457b9d"),document.documentElement.style.setProperty("--contrast-text-color","#000000")}else document.documentElement.style.setProperty("--all-background-color",`var(--${e}-background, #f1faee)`),document.documentElement.style.setProperty("--group-background-color",`var(--${e}-secondary, #a8dadc)`),document.documentElement.style.setProperty("--text-color",`var(--${e}-text, #1d3557)`),document.documentElement.style.setProperty("--accent-color",`var(--${e}-accent, #e63946)`),document.documentElement.style.setProperty("--primary-color",`var(--${e}-primary, #457b9d)`),document.documentElement.style.setProperty("--contrast-text-color",o.has(t)?"#ffffff":"#000000");const n=getComputedStyle(document.documentElement).getPropertyValue("--all-background-color");if(document.body.style.backgroundColor=n,currentSettings.useCustomBackground||(document.documentElement.style.setProperty("--background-image","none"),document.body.classList.remove("bg-loaded")),document.body.classList.add(`theme-${t}`),currentSettings.fontSize&&document.documentElement.style.setProperty("--base-font-size",`${currentSettings.fontSize}px`),currentSettings.groupScale){const e=currentSettings.groupScale/100;document.documentElement.style.setProperty("--group-scale",`${e}`),document.documentElement.style.setProperty("--element-scale",`${e}`),document.documentElement.style.setProperty("--spacing-multiplier",`${e}`),document.documentElement.style.transform=`scale(${e})`,document.documentElement.style.transformOrigin="center top",1!==e&&(document.body.style.height=100/e+"vh",document.body.style.width=100/e+"vw",document.body.style.maxWidth="none",document.body.style.overflow="hidden")}currentSettings.highContrast&&(document.documentElement.style.setProperty("--text-color","#000000"),document.documentElement.style.setProperty("--accent-color","#FF0000"));const r=document.querySelector("#settings-button img");r&&(r.style.filter=o.has(t)?"invert(1)":"invert(0)"),applyGlassBackground()}function setupImageDrop(){const e=document.getElementById("search-container"),t=document.getElementById("search-form");document.getElementById("search-input");if(!e)return void Debugger.error("Search container element not found");const o=document.createElement("div");o.className="drop-indicator",o.textContent="Drop image here to search",o.style.display="none",o.style.position="absolute",o.style.top="0",o.style.left="0",o.style.width="100%",o.style.height="100%",o.style.display="none",o.style.alignItems="center",o.style.justifyContent="center",o.style.backgroundColor="rgba(0,0,0,0.1)",o.style.borderRadius="24px",o.style.fontWeight="bold",o.style.zIndex="10",e.appendChild(o);let n=!1;document.addEventListener("dragover",(r=>{r.preventDefault(),r.dataTransfer&&r.dataTransfer.types&&r.dataTransfer.types.includes("Files")&&(n=!0,e.classList.add("drop-active"),t&&(t.style.display="none"),o.style.display="flex")})),document.addEventListener("dragleave",(r=>{r.relatedTarget&&e.contains(r.relatedTarget)||(n=!1,e.classList.remove("drop-active"),t&&(t.style.display="flex"),o.style.display="none")})),document.addEventListener("drop",(r=>{if(r.preventDefault(),n=!1,e.classList.remove("drop-active"),t&&(t.style.display="flex"),o.style.display="none",r.dataTransfer&&r.dataTransfer.files&&r.dataTransfer.files.length>0){const e=r.dataTransfer.files[0];e.type&&e.type.startsWith("image/")?performImageSearch(e):Debugger.warn("Dropped file is not an image:",e.type)}})),document.addEventListener("dragend",(()=>{n&&(n=!1,e.classList.remove("drop-active"),t&&(t.style.display="flex"),o.style.display="none")}))}function performImageSearch(e){if(e)try{const t=currentSettings.searchEngine||"google",o=new FileReader;o.onerror=function(e){Debugger.error("Error reading image file:",e),alert("There was an error processing your image. Please try again.")},o.onload=function(e){try{e.target.result;let o;switch(t){case"google":default:o="https://images.google.com/";break;case"bing":o="https://www.bing.com/images/search?view=detailv2&iss=sbiupload";break;case"yandex":o="https://yandex.com/images/search"}window.open(o,"_blank")}catch(e){Debugger.error("Error navigating to search URL:",e),window.open("https://images.google.com/","_blank")}},o.readAsDataURL(e)}catch(e){Debugger.error("Error in image search functionality:",e),alert("There was an error processing your image search. Please try again.")}else Debugger.error("No image file provided for search")}function initializeHeaderLinks(){const e=document.querySelector(".header-nav"),t=e.querySelector(".apps-dropdown-container");for(;e.firstChild&&e.firstChild!==t;)e.removeChild(e.firstChild);currentSettings.headerLinks&&currentSettings.headerLinks.length>0&&currentSettings.headerLinks.forEach((o=>{const n=document.createElement("a");n.href=o.url,n.className="nav-link",n.textContent=o.name,e.insertBefore(n,t)}))}function initializeAppsDropdown(){const e=document.getElementById("apps-toggle"),t=document.getElementById("apps-dropdown"),o=document.querySelector(".apps-grid");if(e.addEventListener("click",(function(){t.style.display="block"===t.style.display?"none":"block"})),document.addEventListener("click",(function(o){e.contains(o.target)||t.contains(o.target)||(t.style.display="none")})),currentSettings.apps&&currentSettings.apps.length>0&&(o.innerHTML="",currentSettings.apps.forEach((e=>{const t=document.createElement("a");t.href=e.url,t.className="app-item";const n=document.createElement("img");n.src=getFavicon(e.url),n.alt=e.name,n.className="app-icon",n.onerror=function(){n.src!==e.icon&&(n.src=e.icon)};const r=document.createElement("span");r.textContent=e.name,r.className="app-name",t.appendChild(n),t.appendChild(r),o.appendChild(t)})),window.location.href.includes("editor"))){const e=document.createElement("div");e.className="apps-footer";const o=document.createElement("a");o.href="#",o.className="customize-apps",o.textContent="Customize apps",o.addEventListener("click",(function(e){e.preventDefault(),"function"==typeof openAppsManager&&openAppsManager()})),e.appendChild(o),t.appendChild(e)}}function renderGroupContent(e,t){let o;switch(t.type){case"stack":o=newGroup.stack(t.links,t.x,t.y,t.title);break;case"grid":o=newGroup.grid(t.links,t.x,t.y,t.rows||1,t.columns||1,t.title);break;case"single":t.links&&t.links.length>0&&(o=newGroup.single(t.links[0],t.x,t.y,t.title));break;default:return}if(Array.isArray(t.links)&&t.links.length>20&&o){const e=o.querySelector("ul")||o.querySelector(".grid");if(e){const n=Array.from(e.children);n.slice(20).forEach((e=>e.remove()));const r=document.createElement("button");r.textContent=`Show ${t.links.length-20} more`,r.className="show-more-links",r.onclick=()=>{e.innerHTML="",n.forEach((t=>e.appendChild(t))),r.remove()},o.appendChild(r)}}e.replaceWith(o)}function isColorDark(e){let t,o,n;if(e.startsWith("#")){let r=e.substring(1);3===r.length?(t=parseInt(r.charAt(0)+r.charAt(0),16),o=parseInt(r.charAt(1)+r.charAt(1),16),n=parseInt(r.charAt(2)+r.charAt(2),16)):(t=parseInt(r.substring(0,2),16),o=parseInt(r.substring(2,4),16),n=parseInt(r.substring(4,6),16))}else{if(!e.startsWith("rgb"))return!1;{const r=e.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*[\d.]+)?\)/);if(!r)return!1;t=parseInt(r[1]),o=parseInt(r[2]),n=parseInt(r[3])}}return(299*t+587*o+114*n)/1e3<128}async function loadWidgets(){Debugger.log("Loading widgets from storage...");try{let e=[];if("undefined"!=typeof chrome&&chrome.storage)if(Debugger.log("Chrome storage API available"),chrome.storage.sync){const t=await chrome.storage.sync.get(["groups","groupsLocation"]);if("local"===t.groupsLocation){Debugger.log("Groups are stored in local storage according to sync reference");e=(await chrome.storage.local.get(["groups"])).groups||[]}else if(t.groups&&t.groups.length>0)Debugger.log("Groups found in sync storage"),e=t.groups;else{Debugger.log("Groups not found in sync storage, checking local storage");e=(await chrome.storage.local.get(["groups"])).groups||[]}}else{Debugger.log("Sync storage not available, trying local storage");e=(await chrome.storage.local.get(["groups"])).groups||[]}else{Debugger.warn("Chrome storage API not available, using localStorage fallback");const t=localStorage.getItem("groups");e=t?JSON.parse(t):[]}if(e&&e.length>0){Debugger.log(`Found ${e.length} groups in storage, checking for widgets...`);const t=e.filter((e=>"widget"===e.type));t.length>0?(Debugger.log(`Found ${t.length} widgets to display`),t.forEach(((e,t)=>{if(Debugger.log(`Creating widget: ${e.title} (${e.widgetType})`),"undefined"!=typeof WIDGET_TEMPLATES&&"function"==typeof WIDGET_TEMPLATES.createWidget){const o=WIDGET_TEMPLATES.createWidget(e);o&&(document.getElementById("groups-container").appendChild(o),Array.isArray(WIDGETS)&&WIDGETS.push({id:`widget-${e.widgetType}-${Date.now()}-${t}`,element:o,data:e}))}else Debugger.error("Widget templates not available")}))):Debugger.log("No widgets found in groups")}else Debugger.log("No groups found in storage")}catch(e){Debugger.error("Error loading widgets:",e)}finally{endMeasure()}}function handleWindowResize(){if(loadGroups(),loadWidgets(),currentSettings.searchBarPosition){const e=calculatePosition(currentSettings.searchBarPosition.x,currentSettings.searchBarPosition.y);searchContainer.style.top=100*e.percentY+"%",searchContainer.style.left=100*e.percentX+"%"}initializeShortcuts()}function createGroupPlaceholder(e){const t=document.createElement("div");return t.className="group placeholder",!1!==currentSettings.useGlassBackground&&t.classList.add("glass-background"),t.style.position="absolute",t.style.top=e.styleTop,t.style.left=e.styleLeft,t.style.width="150px",t.style.height="100px",t.style.opacity="0.3",t.style.display="flex",t.style.alignItems="center",t.style.justifyContent="center",t.textContent="Loading...",t}function getFavicon(e){const t="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9ImN1cnJlbnRDb2xvciIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGNsYXNzPSJmZWF0aGVyIGZlYXRoZXItbGluayI+PHBhdGggZD0iTTEwIDEzYTUgNSAwIDAgMCA3LjU0LjU0bDMtM2E1IDUgMCAwIDAtNy4wNy03LjA3bC0xLjcyIDEuNzEiPjwvcGF0aD48cGF0aCBkPSJNMTQgMTFhNSA1IDAgMCAwLTcuNTQtLjU0bC0zIDNhNSA1IDAgMCAwIDcuMDcgNy4wN2wxLjcxLTEuNzEiPjwvcGF0aD48L3N2Zz4=";try{if(!e||""===e.trim())return t;let o;e.startsWith("http://")||e.startsWith("https://")||(e="https://"+e);try{o=new URL(e)}catch(o){return Debugger.error("Invalid URL format:",e,o),t}const n=o.hostname;if(window.faviconCache||(window.faviconCache=new Map),"calendar.google.com"===n){const e=new Date,t="https://ssl.gstatic.com/calendar/images/dynamiclogo_2020q4/calendar_"+e.getDate().toString()+"_2x.png",o=`${n}_${e.toDateString()}`;return window.faviconCache.set(o,t),t}if(window.faviconCache.has(n))return window.faviconCache.get(n);if(!navigator.onLine)return t;const r={"mail.google.com":"https://www.gstatic.com/images/branding/product/1x/gmail_2020q4_32dp.png","drive.google.com":"https://ssl.gstatic.com/docs/doclist/images/drive_2022q3_32dp.png","docs.google.com":"https://ssl.gstatic.com/docs/documents/images/kix-favicon7.ico","sheets.google.com":"https://ssl.gstatic.com/docs/spreadsheets/images/favicon_jfk2.png","slides.google.com":"https://ssl.gstatic.com/docs/presentations/images/favicon5.ico","meet.google.com":"https://www.gstatic.com/meet/favicon_meet_2023_32dp.png","chat.google.com":"https://www.gstatic.com/chat/favicon_chat_32px.png","classroom.google.com":"https://ssl.gstatic.com/classroom/favicon.png","keep.google.com":"https://ssl.gstatic.com/keep/icon_2020q4v2_32dp.png"};if(r[n]){const e=r[n];return window.faviconCache.set(n,e),e}const s=`https://www.google.com/s2/favicons?domain=${n}&sz=64`;return window.faviconCache.set(n,s),s}catch(o){return Debugger.warn("Error getting favicon for URL:",e,o),t}}document.addEventListener("DOMContentLoaded",(async()=>{try{const{settings:e,groups:t}=await fetchSettingsAndGroups();currentSettings={...defaultSettings,...e},applyTheme(),initializeSearch(),initializeHeaderLinks(),lazyRenderGroups(t),initializeAppsDropdown(),deferNonCritical(),setTimeout((()=>{if(currentSettings.useCustomBackground){document.body.classList.add("bg-transition");const e=(e,t)=>{if(!e)return void(t&&t(!1));const o=new Image;o.onload=function(){t&&t(!0,e)},o.onerror=function(){t&&t(!1)},o.src=e};if("undefined"!=typeof chrome&&chrome.storage&&chrome.storage.local)chrome.storage.local.get(["backgroundImage"],(t=>{const o=t.backgroundImage||currentSettings.backgroundURL;o&&e(o,((e,t)=>{e?(document.getElementById("background-image").style.backgroundImage=`url("${t}")`,document.getElementById("background-image").classList.add("background-image")):Debugger.warn("Failed to load background image:",o)})),document.querySelectorAll(".group.placeholder.glass-background").forEach((e=>e.remove()))}));else{const t=currentSettings.backgroundImage||currentSettings.backgroundURL;t&&e(t,((e,o)=>{e?(document.getElementById("background-image").style.backgroundImage=`url("${o}")`,document.getElementById("background-image").classList.add("bg-loaded")):Debugger.warn("Failed to load background image:",t)}))}}}),200)}catch(e){Debugger.error("Error initializing page:",e)}}));