const groupsContainer=document.getElementById("groups-editor-container"),newGroupBtn=document.getElementById("new-group-btn"),saveChangesBtn=document.getElementById("save-changes-btn"),toggleDragBtn=document.getElementById("toggle-drag-btn"),searchEditor=document.getElementById("search-editor"),editPopup=document.getElementById("edit-group-popup"),newGroupPopup=document.getElementById("new-group-popup"),linksEditor=document.getElementById("group-links-editor"),newGroupLinks=document.getElementById("new-group-links");function isColorDark(e){let t,n,o;if(e.startsWith("#")){let r=e.substring(1);3===r.length?(t=parseInt(r.charAt(0)+r.charAt(0),16),n=parseInt(r.charAt(1)+r.charAt(1),16),o=parseInt(r.charAt(2)+r.charAt(2),16)):(t=parseInt(r.substring(0,2),16),n=parseInt(r.substring(2,4),16),o=parseInt(r.substring(4,6),16))}else{if(!e.startsWith("rgb"))return!1;{const r=e.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*[\d.]+)?\)/);if(!r)return!1;t=parseInt(r[1]),n=parseInt(r[2]),o=parseInt(r[3])}}return(299*t+587*n+114*o)/1e3<128}function applyThemeToEditor(){const e=currentSettings.theme||"light";if(e.startsWith("custom-")&&currentSettings.customThemes){const t=currentSettings.customThemes.find((t=>t.id===e));if(t){document.documentElement.style.setProperty("--all-background-color",t.background),document.documentElement.style.setProperty("--group-background-color",t.secondary),document.documentElement.style.setProperty("--text-color",t.text),document.documentElement.style.setProperty("--accent-color",t.accent),document.documentElement.style.setProperty("--primary-color",t.primary);const e=isColorDark(t.primary);document.documentElement.style.setProperty("--contrast-text-color",e?"#ffffff":"#000000")}}else if("custom"===e){const e="#457b9d",t="#a8dadc",n="#e63946",o="#1d3557",r="#f1faee";document.documentElement.style.setProperty("--all-background-color",r),document.documentElement.style.setProperty("--group-background-color",t),document.documentElement.style.setProperty("--text-color",o),document.documentElement.style.setProperty("--accent-color",n),document.documentElement.style.setProperty("--primary-color",e);const i=isColorDark(e);document.documentElement.style.setProperty("--contrast-text-color",i?"#ffffff":"#000000")}else{document.documentElement.style.setProperty("--all-background-color",`var(--${e}-background, #f1faee)`),document.documentElement.style.setProperty("--group-background-color",`var(--${e}-secondary, #a8dadc)`),document.documentElement.style.setProperty("--text-color",`var(--${e}-text, #1d3557)`),document.documentElement.style.setProperty("--accent-color",`var(--${e}-accent, #e63946)`),document.documentElement.style.setProperty("--primary-color",`var(--${e}-primary, #457b9d)`);let t=!1;"dark"!==e&&"midnight"!==e&&"emerald"!==e&&"slate"!==e&&"deep"!==e&&"nord"!==e&&"cyber"!==e||(t=!0),document.documentElement.style.setProperty("--contrast-text-color",t?"#ffffff":"#000000")}document.body.style.backgroundColor=getComputedStyle(document.documentElement).getPropertyValue("--all-background-color")}let currentGroups=[],currentSettings={},editingGroupIndex=-1,dragEnabled=!1,activeGroup=null,initialX=0,initialY=0,offsetX=0,offsetY=0;const GRID_SIZE_X=2,GRID_SIZE_Y=2,MIN_MARGIN=0,GRID_DIVISIONS_X=Math.round(50),GRID_DIVISIONS_Y=Math.round(50),defaultSettings={theme:"light",backgroundURL:"",showSearch:!0,searchEngine:"google",searchBarPosition:{x:10,y:120},headerLinks:[{name:"Gmail",url:"https://mail.google.com"},{name:"Photos",url:"https://photos.google.com"},{name:"Search Labs",url:"https://labs.google.com"}]};function applyScalingSettings(e){e&&(document.documentElement.style.setProperty("--base-font-size",`${e.baseFontSize||16}px`),document.documentElement.style.setProperty("--group-scale",e.groupScale||1),document.documentElement.style.setProperty("--spacing-scale",e.spacingScale||1),document.documentElement.style.setProperty("--text-scale",e.textScale||1),document.documentElement.style.setProperty("--element-scale",e.elementScale||1),document.documentElement.style.setProperty("--spacing-multiplier",e.spacingMultiplier||1),console.log("Applied scaling settings:",e))}function applyThemeToEditor(){if(currentSettings&&currentSettings.theme){const e=currentSettings.theme||"light",t=e.startsWith("custom-");if(document.body.className="",document.body.classList.add(`theme-${e.split("-")[0]}`),t&&currentSettings.customThemes){const t=currentSettings.customThemes.find((t=>t.id===e));t&&(document.documentElement.style.setProperty("--all-background-color",t.background),document.documentElement.style.setProperty("--group-background-color",t.secondary),document.documentElement.style.setProperty("--text-color",t.text),document.documentElement.style.setProperty("--accent-color",t.accent),document.documentElement.style.setProperty("--primary-color",t.primary))}else"custom"===e?(document.documentElement.style.setProperty("--all-background-color","#f1faee"),document.documentElement.style.setProperty("--group-background-color","#a8dadc"),document.documentElement.style.setProperty("--text-color","#1d3557"),document.documentElement.style.setProperty("--accent-color","#e63946"),document.documentElement.style.setProperty("--primary-color","#457b9d")):(document.documentElement.style.setProperty("--all-background-color",`var(--${e}-background, #f1faee)`),document.documentElement.style.setProperty("--group-background-color",`var(--${e}-secondary, #a8dadc)`),document.documentElement.style.setProperty("--text-color",`var(--${e}-text, #1d3557)`),document.documentElement.style.setProperty("--accent-color",`var(--${e}-accent, #e63946)`),document.documentElement.style.setProperty("--primary-color",`var(--${e}-primary, #457b9d)`));currentSettings.useCustomBackground?currentSettings.backgroundImage?document.documentElement.style.setProperty("--background-image",`url(${currentSettings.backgroundImage})`):currentSettings.backgroundURL&&document.documentElement.style.setProperty("--background-image",`url(${currentSettings.backgroundURL})`):document.documentElement.style.setProperty("--background-image","none")}}function handleWindowResize(){if(renderGroups(),currentSettings.searchBarPosition)if("string"==typeof currentSettings.searchBarPosition.x&&currentSettings.searchBarPosition.x.endsWith("%")&&"string"==typeof currentSettings.searchBarPosition.y&&currentSettings.searchBarPosition.y.endsWith("%"))searchEditor.style.top=currentSettings.searchBarPosition.y,searchEditor.style.left=currentSettings.searchBarPosition.x;else{const e=calculatePosition(currentSettings.searchBarPosition.x,currentSettings.searchBarPosition.y);searchEditor.style.top=100*e.percentY+"%",searchEditor.style.left=100*e.percentX+"%"}}function renderGroups(){groupsContainer.innerHTML="",currentGroups.forEach(((e,t)=>{const n=createGroupElement(e,t);groupsContainer.appendChild(n)}))}function calculatePosition(e,t){let n,o;if("string"==typeof e&&e.endsWith("%"))n=parseFloat(e)/100,n=Math.round(n*GRID_DIVISIONS_X)/GRID_DIVISIONS_X;else{const t=parseFloat(e);n=isNaN(t)?.5:t/100,n=Math.round(n*GRID_DIVISIONS_X)/GRID_DIVISIONS_X}if("string"==typeof t&&t.endsWith("%"))o=parseFloat(t)/100,o=Math.round(o*GRID_DIVISIONS_Y)/GRID_DIVISIONS_Y;else{const e=parseFloat(t);o=isNaN(e)?.5:e/100,o=Math.round(o*GRID_DIVISIONS_Y)/GRID_DIVISIONS_Y}n=Math.max(0,Math.min(1,n)),o=Math.max(0,Math.min(1,o));return{x:n*window.innerWidth,y:o*window.innerHeight,percentX:n,percentY:o}}function createGroupElement(e,t){const n=document.createElement("div");n.className="editor-group glass-background",n.dataset.index=t;const o=calculatePosition(e.x||10,e.y||10);if(n.style.position="absolute",n.style.top=100*o.percentY+"%",n.style.left=100*o.percentX+"%",n.style.transform="translate(-50%, -50%)",dragEnabled&&(n.classList.add("draggable"),n.addEventListener("mousedown",handleMouseDown)),"widget"===e.type)return createWidgetElement(e,t,n,o);const r=document.createElement("div");r.className="group-header";if(e.title&&e.title.trim().length>0){const n=document.createElement("input");n.type="text",n.value=e.title,n.className="group-title",n.onchange=e=>updateGroupTitle(t,e.target.value),r.appendChild(n)}else r.style.display="flex",r.style.justifyContent="flex-end";const i=document.createElement("div");i.className="group-controls";const s=document.createElement("button");s.className="icon-button edit-group-btn",s.innerHTML="‚úé",s.onclick=()=>openEditPopup(t);const a=document.createElement("button");a.className="icon-button remove-group-btn",a.innerHTML="‚úï",a.onclick=()=>removeGroup(t),i.appendChild(s),i.appendChild(a),r.appendChild(i),n.appendChild(r);const l=document.createElement("div");return l.className="grid"===e.type?"grid":"stack","grid"===e.type&&e.rows&&e.columns&&(l.style.gridTemplateColumns=`repeat(${e.columns}, 1fr)`,l.style.gridTemplateRows=`repeat(${e.rows}, 1fr)`),e.links.forEach((t=>{const n=getFavicon(t.url);"stack"===e.type?l.innerHTML+=`\n                <div class="link-stack">\n                    <img src="${n}" alt="${t.title}"/>\n                    <span>${t.title}</span>\n                </div>\n            `:l.innerHTML+=`\n                <div class="link-grid">\n                    <img src="${n}" alt="${t.title}"/>\n                    <span>${t.title}</span>\n                </div>\n            `})),n.appendChild(l),n}function createWidgetElement(e,t,n,o){n.classList.add("widget-container");const r=document.createElement("div");r.className="group-header";const i=document.createElement("input");i.type="text",i.value=e.title||"Widget",i.className="group-title",i.onchange=e=>updateGroupTitle(t,e.target.value),r.appendChild(i);const s=document.createElement("div");s.className="group-controls";const a=document.createElement("button");a.className="icon-button edit-group-btn",a.innerHTML="‚öôÔ∏è",a.title="Widget Settings",a.onclick=()=>openWidgetSettings(t);const l=document.createElement("button");l.className="icon-button remove-group-btn",l.innerHTML="‚úï",l.title="Remove Widget",l.onclick=()=>removeGroup(t),s.appendChild(a),s.appendChild(l),r.appendChild(s),n.appendChild(r);const c=document.createElement("div");c.className="widget-preview",c.style.padding="15px",c.style.minWidth="200px",c.style.minHeight="150px",c.style.display="flex",c.style.flexDirection="column",c.style.alignItems="center",c.style.justifyContent="center";const d=document.createElement("div");d.style.fontSize="48px",d.style.marginBottom="10px",d.textContent=e.icon||"üîß";const u=document.createElement("div");u.textContent=e.title||"Widget",u.style.fontWeight="bold";const p=document.createElement("div");return p.textContent=getWidgetTypeDescription(e.widgetType),p.style.fontSize="12px",p.style.opacity="0.7",p.style.marginTop="5px",p.style.textAlign="center",c.appendChild(d),c.appendChild(u),c.appendChild(p),n.appendChild(c),n}function getWidgetTypeDescription(e){for(const t in WIDGET_TYPES){const n=WIDGET_TYPES[t];for(const t in n.widgets){const o=n.widgets[t];if(o.id===e)return o.description}}return"Custom widget"}function updateGroupTitle(e,t){currentGroups[e].title=t}function removeGroup(e){currentGroups.splice(e,1),renderGroups()}function createLinkInputs(e,t={title:"",url:""},n=null){const o=document.createElement("div");o.className="link-editor";const r=e.querySelectorAll(".link-editor").length,i=document.createElement("select");i.className="link-index";for(let e=0;e<=r;e++){const t=document.createElement("option");t.value=e,t.text=e+1,i.appendChild(t)}i.value=null!==n?n:r,o.appendChild(i);const s=document.createElement("input");s.type="text",s.className="link-title",s.placeholder="Link Title",s.value=t.title||"",o.appendChild(s);const a=document.createElement("input");a.type="url",a.className="link-url",a.placeholder="Link URL",a.value=t.url||"",o.appendChild(a);const l=document.createElement("button");l.className="remove-link-btn",l.textContent="Remove",l.addEventListener("click",(()=>o.remove())),o.appendChild(l),i.addEventListener("change",(e=>reorderLink(o,parseInt(e.target.value)))),null!==n&&n<e.children.length?e.insertBefore(o,e.children[n]):e.appendChild(o)}function reorderLink(e,t){const n=e.parentElement;Array.from(n.children).indexOf(e)!==t&&(n.removeChild(e),t>=n.children.length?n.appendChild(e):n.insertBefore(e,n.children[t]),updateLinkIndexes(n))}function updateLinkIndexes(e){const t=e.querySelectorAll(".link-editor");t.forEach(((e,n)=>{const o=e.querySelector(".link-index"),r=parseInt(o.value);o.innerHTML="";for(let e=0;e<t.length;e++){const t=document.createElement("option");t.value=e,t.text=e+1,o.appendChild(t)}r<t.length?o.value=r:o.value=n}))}function toggleGridSettings(){const e=document.getElementById("new-group-type").value;if(document.getElementById("grid-settings").style.display="grid"===e?"block":"none","single"===e){const e=newGroupLinks.querySelectorAll(".link-editor");if(e.length>1)for(let t=1;t<e.length;t++)e[t].remove();document.getElementById("add-new-group-link-btn").disabled=!0}else document.getElementById("add-new-group-link-btn").disabled=!1}function createNewGroup(){const e=document.getElementById("new-group-title").value,t=document.getElementById("new-group-type").value,n=Array.from(newGroupLinks.querySelectorAll(".link-editor")),o=[];n.forEach((e=>{const t={title:e.querySelector(".link-title").value,url:e.querySelector(".link-url").value,index:parseInt(e.querySelector(".link-index").value)};t.title&&t.url&&o.push(t)})),o.sort(((e,t)=>e.index-t.index));const r=o.map((e=>({title:e.title,url:e.url})));let i=10;const s=currentGroups.map((e=>({x:e.x,y:e.y})));if(s.length>0)for(;s.some((e=>Math.abs(e.x-10)<50&&Math.abs(e.y-i)<50));)i+=100;const a={type:t,title:e,links:r,x:10,y:i};"grid"===t&&(a.rows=parseInt(document.getElementById("grid-rows").value)||1,a.columns=parseInt(document.getElementById("grid-columns").value)||1),currentGroups.push(a),renderGroups(),document.getElementById("new-group-popup").style.display="none"}function openEditPopup(e){editingGroupIndex=e;const t=currentGroups[e];document.getElementById("new-group-popup").style.display="flex",document.getElementById("new-group-title").value=t.title||"",document.getElementById("new-group-type").value=t.type,"grid"===t.type&&(document.getElementById("grid-rows").value=t.rows||1,document.getElementById("grid-columns").value=t.columns||1),toggleGridSettings(),newGroupLinks.innerHTML="",t.links.forEach(((e,t)=>createLinkInputs(newGroupLinks,e,t)));const n=document.getElementById("create-new-group-btn");n.textContent="Save Changes",n.onclick=saveGroupChanges}function saveGroupChanges(){const e=document.getElementById("new-group-title").value,t=document.getElementById("new-group-type").value,n=Array.from(newGroupLinks.querySelectorAll(".link-editor")),o=[];n.forEach((e=>{const t={title:e.querySelector(".link-title").value,url:e.querySelector(".link-url").value,index:parseInt(e.querySelector(".link-index").value)};t.title&&t.url&&o.push(t)})),o.sort(((e,t)=>e.index-t.index));const r=o.map((e=>({title:e.title,url:e.url}))),i=currentGroups[editingGroupIndex].x||10,s=currentGroups[editingGroupIndex].y||10,a={...currentGroups[editingGroupIndex],type:t,title:e,links:r,x:i,y:s};"grid"===t?(a.rows=parseInt(document.getElementById("grid-rows").value)||1,a.columns=parseInt(document.getElementById("grid-columns").value)||1):(delete a.rows,delete a.columns),currentGroups[editingGroupIndex]=a,renderGroups(),document.getElementById("new-group-popup").style.display="none";const l=document.getElementById("create-new-group-btn");l.textContent="Create Group",l.onclick=createNewGroup}function initDraggableElement(e,t){if(!e)return;const n=e.querySelector(".editor-handle");n?n.addEventListener("mousedown",(function(n){if(!dragEnabled)return;n.preventDefault(),initialX=n.clientX,initialY=n.clientY;const o=e.getBoundingClientRect(),r=window.innerWidth,i=window.innerHeight;let s=(o.left+o.width/2)/r,a=(o.top+o.height/2)/i;offsetX=s,offsetY=a;const l=e.style.transform;activeGroup=e,e.style.position="absolute",dragEnabled&&(gridOverlay.style.display="block"),document.addEventListener("mousemove",handleDraggableMove),document.addEventListener("mouseup",(function(){stopDraggableMove(e,t,l)}))})):console.error(`Handle not found for ${t}`)}function handleDraggableMove(e){if(!activeGroup)return;e.preventDefault();const t=window.innerWidth,n=window.innerHeight,o=(e.clientX-initialX)/t,r=(e.clientY-initialY)/n;let i=offsetX+o,s=offsetY+r;dragEnabled&&(i=Math.round(i*GRID_DIVISIONS_X)/GRID_DIVISIONS_X,s=Math.round(s*GRID_DIVISIONS_Y)/GRID_DIVISIONS_Y),i=Math.max(0,Math.min(1,i)),s=Math.max(0,Math.min(1,s)),activeGroup.style.left=100*i+"%",activeGroup.style.top=100*s+"%",activeGroup.style.transform="translate(-50%, -50%)"}function handleDraggableMove(e){if(!activeGroup)return;e.preventDefault();const t=window.innerWidth,n=window.innerHeight,o=(e.clientX-initialX)/t,r=(e.clientY-initialY)/n;let i=offsetX+o,s=offsetY+r;dragEnabled&&(i=Math.round(i*GRID_DIVISIONS_X)/GRID_DIVISIONS_X,s=Math.round(s*GRID_DIVISIONS_Y)/GRID_DIVISIONS_Y),i=Math.max(0,Math.min(1,i)),s=Math.max(0,Math.min(1,s)),activeGroup.style.left=100*i+"%",activeGroup.style.top=100*s+"%",activeGroup.style.transform="translate(-50%, -50%)"}function stopDraggableMove(e,t,n){document.removeEventListener("mousemove",handleDraggableMove),document.removeEventListener("mouseup",arguments.callee),gridOverlay.style.display="none",e.style.transform="translate(-50%, -50%)";let o=e.style.left,r=e.style.top;o&&r?o.endsWith("%")&&r.endsWith("%")?activeGroup=null:console.error("Element position is not in percentage format"):console.error("Element position is missing")}function moveSearchBar(e){e.preventDefault();const t=window.innerWidth,n=window.innerHeight,o=(e.clientX-initialX)/t,r=(e.clientY-initialY)/n;let i=offsetX+o,s=offsetY+r;dragEnabled&&(i=Math.round(i*GRID_DIVISIONS_X)/GRID_DIVISIONS_X,s=Math.round(s*GRID_DIVISIONS_Y)/GRID_DIVISIONS_Y),i=Math.max(0,Math.min(1,i)),s=Math.max(0,Math.min(1,s)),searchEditor.style.left=100*i+"%",searchEditor.style.top=100*s+"%"}function initSearchBarDrag(){if(!searchEditor)return;searchEditor.classList.add("draggable");(searchEditor.querySelector(".editor-handle")||searchEditor).addEventListener("mousedown",(function(e){if(!dragEnabled)return;e.preventDefault(),initialX=e.clientX,initialY=e.clientY;const t=searchEditor.getBoundingClientRect(),n=window.innerWidth,o=window.innerHeight;let r=(t.left+t.width/2)/n,i=(t.top+t.height/2)/o;offsetX=r,offsetY=i,searchEditor.classList.add("dragging"),gridOverlay.style.display="block",document.addEventListener("mousemove",moveSearchBar),document.addEventListener("mouseup",stopSearchBarDrag)}))}function moveSearchBar(e){e.preventDefault();const t=window.innerWidth,n=window.innerHeight,o=(e.clientX-initialX)/t,r=(e.clientY-initialY)/n;let i=offsetX+o,s=offsetY+r;dragEnabled&&(i=Math.round(i*GRID_DIVISIONS_X)/GRID_DIVISIONS_X,s=Math.round(s*GRID_DIVISIONS_Y)/GRID_DIVISIONS_Y),i=Math.max(0,Math.min(1,i)),s=Math.max(0,Math.min(1,s)),searchEditor.style.left=100*i+"%",searchEditor.style.top=100*s+"%"}function stopSearchBarDrag(){document.removeEventListener("mousemove",moveSearchBar),document.removeEventListener("mouseup",stopSearchBarDrag),gridOverlay.style.display="none",searchEditor.classList.remove("dragging");const e=searchEditor.style.left,t=searchEditor.style.top;e&&t&&(currentSettings.searchBarPosition={x:e,y:t})}function populateWidgetMenu(){try{const e=document.getElementById("widget-menu");if(!e)return;if(e.innerHTML="","undefined"==typeof WIDGET_TYPES){console.error("WIDGET_TYPES not defined, cannot populate widget menu");const t=document.createElement("div");return t.className="widget-error",t.textContent="Widget configuration not available",void e.appendChild(t)}for(const t in WIDGET_TYPES){const n=WIDGET_TYPES[t],o=document.createElement("div");o.className="widget-group";const r=document.createElement("div");r.className="widget-group-title",r.textContent=n.title,o.appendChild(r);const i=document.createElement("div");i.className="widget-list";for(const e in n.widgets){const t=n.widgets[e],o=document.createElement("div");o.className="widget-item",o.dataset.widget=t.id;const r=document.createElement("div");r.className="widget-icon",r.textContent=t.icon;const s=document.createElement("div");s.className="widget-name",s.textContent=t.name,o.appendChild(r),o.appendChild(s),o.addEventListener("click",(function(){const e={type:"widget",widgetType:t.id,title:t.name,icon:t.icon,x:"50%",y:"50%",settings:{}};currentGroups.push(e),renderGroups(),document.getElementById("widget-menu").style.display="none";const n=document.createElement("div");n.className="widget-notification",n.textContent=`Added ${t.name} widget! You can drag it to position it.`,n.style.position="fixed",n.style.bottom="20px",n.style.left="50%",n.style.transform="translateX(-50%)",n.style.backgroundColor="var(--primary-color)",n.style.color="var(--contrast-text-color, white)",n.style.padding="10px 20px",n.style.borderRadius="4px",n.style.boxShadow="0 2px 10px rgba(0, 0, 0, 0.2)",n.style.zIndex="9999",document.body.appendChild(n),setTimeout((()=>{n.style.opacity="0",n.style.transition="opacity 0.5s",setTimeout((()=>{document.body.removeChild(n)}),500)}),3e3)})),i.appendChild(o)}o.appendChild(i),e.appendChild(o)}}catch(e){console.error("Error populating widget menu:",e)}}document.addEventListener("DOMContentLoaded",(async()=>{try{if("undefined"!=typeof chrome&&chrome.storage){console.log("Chrome storage API available, loading data...");let e={};if(chrome.storage.sync&&(e=await chrome.storage.sync.get(["settings","groupsLocation","groups","scaling"])),currentSettings=e.settings||{...defaultSettings},e.scaling&&(console.log("Applying scaling settings from Chrome sync storage"),applyScalingSettings(e.scaling)),"local"===e.groupsLocation){const e=await chrome.storage.local.get(["groups"]);currentGroups=e.groups||[],console.log("Groups loaded from Chrome local storage")}else if(chrome.storage.sync&&e.groups&&e.groups.length>0)currentGroups=e.groups,console.log("Groups loaded from Chrome sync storage");else{const e=await chrome.storage.local.get(["groups"]);currentGroups=e.groups||[],console.log("Groups loaded from Chrome local storage (fallback)")}if(currentSettings.useCustomBackground)try{const e=await chrome.storage.local.get(["backgroundImage"]);e.backgroundImage&&(currentSettings.backgroundImage=e.backgroundImage,console.log("Background image loaded from Chrome local storage"))}catch(e){console.warn("Error loading background image from local storage:",e)}}else{console.warn("Chrome storage API not available, using localStorage fallback");const e=localStorage.getItem("groups"),t=localStorage.getItem("settings");if(currentGroups=e?JSON.parse(e):[],currentSettings=t?JSON.parse(t):{...defaultSettings},currentSettings.useCustomBackground)try{const e=localStorage.getItem("backgroundImage");e&&(currentSettings.backgroundImage=e)}catch(e){console.warn("Error loading background image from localStorage:",e)}}if(currentSettings.headerLinks||(currentSettings.headerLinks=defaultSettings.headerLinks),applyThemeToEditor(),currentSettings.searchBarPosition){if("string"==typeof currentSettings.searchBarPosition.x&&currentSettings.searchBarPosition.x.endsWith("%")&&"string"==typeof currentSettings.searchBarPosition.y&&currentSettings.searchBarPosition.y.endsWith("%"))searchEditor.style.top=currentSettings.searchBarPosition.y,searchEditor.style.left=currentSettings.searchBarPosition.x;else{const e=calculatePosition(currentSettings.searchBarPosition.x,currentSettings.searchBarPosition.y);searchEditor.style.top=100*e.percentY+"%",searchEditor.style.left=100*e.percentX+"%"}searchEditor.style.transform="translate(-50%, -50%)"}searchEditor.style.display=currentSettings.showSearch?"block":"none",initSearchBarDrag(),renderGroups(),window.addEventListener("resize",handleWindowResize)}catch(e){console.error("Error loading data:",e),currentGroups=[],currentSettings={...defaultSettings},renderGroups()}})),document.getElementById("new-group-type").addEventListener("change",toggleGridSettings),document.getElementById("add-new-group-link-btn").addEventListener("click",(()=>{createLinkInputs(newGroupLinks)})),document.getElementById("cancel-new-group-btn").addEventListener("click",(()=>{newGroupPopup.style.display="none"})),document.getElementById("add-group-button")&&document.getElementById("add-group-button").addEventListener("click",(function(){document.getElementById("new-group-popup").style.display="flex",document.getElementById("new-group-title").value="",document.getElementById("new-group-type").value="stack",document.getElementById("grid-rows").value="1",document.getElementById("grid-columns").value="1",toggleGridSettings(),newGroupLinks.innerHTML="",createLinkInputs(newGroupLinks);const e=document.getElementById("create-new-group-btn");e.textContent="Create Group",e.onclick=createNewGroup,document.getElementById("add-options").style.display="none"})),document.getElementById("add-widget-button")&&document.getElementById("add-widget-button").addEventListener("click",(function(){const e=document.getElementById("widget-menu");e.querySelector(".widget-group")||populateWidgetMenu(),"block"===e.style.display?e.style.display="none":(e.style.display="block",document.getElementById("add-options").style.display="none")})),document.addEventListener("click",(function(e){const t=document.getElementById("widget-menu"),n=document.getElementById("add-options"),o=document.getElementById("new-group-btn"),r=document.getElementById("add-widget-button");document.getElementById("add-group-button");t&&"block"===t.style.display&&!t.contains(e.target)&&e.target!==r&&(t.style.display="none"),n&&"flex"===n.style.display&&!n.contains(e.target)&&e.target!==o&&(n.style.display="none")})),newGroupBtn.addEventListener("click",(function(e){const t=document.getElementById("add-options");e.stopPropagation(),"flex"===t.style.display?t.style.display="none":t.style.display="flex"})),saveChangesBtn.addEventListener("click",(async()=>{try{const e=document.getElementById("save-changes-btn"),t=e.innerHTML;if(e.innerHTML="Saving...","undefined"!=typeof chrome&&chrome.storage){const e=sanitizeGroupLinks(currentGroups);if(chrome.storage.sync)try{const t={...currentSettings};let n=null;t.backgroundImage&&(n=t.backgroundImage,t.backgroundImage=null),await chrome.storage.sync.set({settings:t}),await chrome.storage.local.set({groups:e}),n&&await chrome.storage.local.set({backgroundImage:n}),await chrome.storage.sync.set({groupsLocation:"local"}),console.log("Data successfully saved to Chrome storage (split between sync and local)")}catch(t){console.warn("Error saving to sync storage, falling back to local storage",t);const n={...currentSettings};let o=null;n.backgroundImage&&(o=n.backgroundImage,n.backgroundImage=null),await chrome.storage.local.set({groups:e,settings:n,groupsLocation:"local"}),o&&await chrome.storage.local.set({backgroundImage:o})}else{const t={...currentSettings};let n=null;t.backgroundImage&&(n=t.backgroundImage,t.backgroundImage=null),await chrome.storage.local.set({groups:e,settings:t}),n&&await chrome.storage.local.set({backgroundImage:n})}currentGroups=e}else{const e=sanitizeGroupLinks(currentGroups);localStorage.setItem("groups",JSON.stringify(e)),localStorage.setItem("settings",JSON.stringify(currentSettings)),currentGroups=e,console.warn("Saved to localStorage (Chrome API not available)")}e.innerHTML="Saved!",setTimeout((()=>{e.innerHTML=t}),2e3)}catch(e){console.error("Error saving data:",e),alert(`Error saving data: ${e.message}`),document.getElementById("save-changes-btn").innerHTML="<i>üíæ</i>"}}));const gridOverlay=document.createElement("div");gridOverlay.className="grid-overlay",document.body.appendChild(gridOverlay);const ruleOfThirdsOverlay=document.createElement("div");function handleDragStart(e){activeGroup=e.target,activeGroup.classList.add("dragging"),initialX=e.clientX,initialY=e.clientY}function handleDragEnd(e){if(!activeGroup)return;activeGroup.classList.remove("dragging");const t=parseInt(activeGroup.dataset.index);t>=0&&t<currentGroups.length&&updateGroupPosition(t,activeGroup.offsetLeft,activeGroup.offsetTop),activeGroup=null}function handleMouseDown(e){if(!dragEnabled)return;if("INPUT"===e.target.tagName||"BUTTON"===e.target.tagName)return;activeGroup=e.currentTarget,initialX=e.clientX,initialY=e.clientY;const t=window.getComputedStyle(activeGroup),n=t.left,o=t.top,r=window.innerWidth,i=window.innerHeight;let s=.5,a=.5;if(n.endsWith("%"))s=parseFloat(n)/100;else{s=(parseInt(n)||0)/r}if(o.endsWith("%"))a=parseFloat(o)/100;else{a=(parseInt(o)||0)/i}offsetX=s,offsetY=a,activeGroup.classList.add("dragging"),gridOverlay.style.display="block",document.body.style.userSelect="none",e.preventDefault(),document.addEventListener("mousemove",handleMouseMove),document.addEventListener("mouseup",handleMouseUp)}function handleMouseUp(e){if(!activeGroup)return;activeGroup.classList.remove("dragging"),document.body.style.userSelect="",gridOverlay.style.display="none",ruleOfThirdsOverlay.style.display=dragEnabled?"block":"none";const t=parseInt(activeGroup.dataset.index);if(t>=0&&t<currentGroups.length){const e=activeGroup.style.left,n=activeGroup.style.top;currentGroups[t].x=e,currentGroups[t].y=n}document.removeEventListener("mousemove",handleMouseMove),document.removeEventListener("mouseup",handleMouseUp),activeGroup=null}function handleMouseMove(e){if(!activeGroup)return;e.preventDefault();const t=window.innerWidth,n=window.innerHeight,o=(e.clientX-initialX)/t,r=(e.clientY-initialY)/n;let i=offsetX+o,s=offsetY+r;dragEnabled&&(i=Math.round(i*GRID_DIVISIONS_X)/GRID_DIVISIONS_X,s=Math.round(s*GRID_DIVISIONS_Y)/GRID_DIVISIONS_Y);i=Math.max(0,Math.min(1,i)),s=Math.max(0,Math.min(1,s)),activeGroup.style.left=100*i+"%",activeGroup.style.top=100*s+"%",activeGroup.style.transform="translate(-50%, -50%)"}function updateGroupPosition(e,t,n){if("string"==typeof t&&t.endsWith("%")&&"string"==typeof n&&n.endsWith("%")){let o=parseFloat(t)/100,r=parseFloat(n)/100;return o=Math.round(o*GRID_DIVISIONS)/GRID_DIVISIONS,r=Math.round(r*GRID_DIVISIONS)/GRID_DIVISIONS,currentGroups[e].x=100*o+"%",void(currentGroups[e].y=100*r+"%")}const o=parseInt(t,10),r=parseInt(n,10);let i=o/window.innerWidth,s=r/window.innerHeight;i=Math.round(i*GRID_DIVISIONS)/GRID_DIVISIONS,s=Math.round(s*GRID_DIVISIONS)/GRID_DIVISIONS;i=Math.max(0,Math.min(1,i)),s=Math.max(0,Math.min(1,s)),currentGroups[e].x=100*i+"%",currentGroups[e].y=100*s+"%"}function openWidgetSettings(e){const t=currentGroups[e],n=document.createElement("div");n.className="popup",n.style.display="flex";const o=document.createElement("div");o.className="popup-content";const r=document.createElement("h2");r.textContent=`${t.title||"Widget"} Settings`,o.appendChild(r);const i=document.createElement("p");i.textContent=`Configure your ${t.title||"Widget"} widget.`,o.appendChild(i);const s=document.createElement("div");switch(s.className="widget-settings-form",s.style.margin="20px 0",t.settings||(t.settings={}),t.widgetType){case"weather":createWeatherWidgetSettings(s,t);break;case"analog-clock":case"digital-clock":createClockWidgetSettings(s,t);break;default:s.innerHTML='\n                <p style="text-align: center; padding: 30px; background: rgba(0,0,0,1); border-radius: 8px;">\n                    Additional settings for this widget type will be available in a future update.\n                </p>\n            '}o.appendChild(s);const a=document.createElement("div");a.className="popup-buttons";const l=document.createElement("button");l.className="primary",l.textContent="Save",l.onclick=()=>{saveWidgetSettings(t,s),document.body.removeChild(n),renderGroups()};const c=document.createElement("button");c.textContent="Cancel",c.onclick=()=>document.body.removeChild(n),a.appendChild(l),a.appendChild(c),o.appendChild(a),n.appendChild(o),document.body.appendChild(n)}function createWeatherWidgetSettings(e,t){t.settings||(t.settings={});const n=`\n        <div class="settings-row">\n            <label for="weather-location">Location</label>\n            <input type="text" id="weather-location" value="${t.settings.location||""}" \n                   placeholder="Enter zip code, city name, or 'auto' for current location">\n            <p class="field-help">Enter a US ZIP code (e.g., 10001), city name (e.g., New York), or "auto" for automatic location detection</p>\n        </div>\n        \n        <div class="settings-row">\n            <label for="weather-units">Units</label>\n            <select id="weather-units">\n                <option value="imperial" ${"imperial"!==t.settings.units&&t.settings.units?"":"selected"}>Fahrenheit (¬∞F)</option>\n                <option value="metric" ${"metric"===t.settings.units?"selected":""}>Celsius (¬∞C)</option>\n            </select>\n        </div>\n    `;e.innerHTML=n;const o=document.createElement("style");o.textContent='\n        .widget-settings-form .settings-row {\n            margin-bottom: 15px;\n        }\n        \n        .widget-settings-form label {\n            display: block;\n            margin-bottom: 5px;\n            font-weight: bold;\n        }\n        \n        .widget-settings-form input[type="text"],\n        .widget-settings-form select {\n            width: 100%;\n            padding: 8px;\n            border: 1px solid #ddd;\n            border-radius: 4px;\n            font-size: 14px;\n        }\n        \n        .widget-settings-form .field-help {\n            margin-top: 5px;\n            font-size: 12px;\n            color: #666;\n        }\n    ',document.head.appendChild(o)}function createClockWidgetSettings(e,t){t.settings||(t.settings={});const n="digital-clock"===t.widgetType;let o=`\n        <div class="settings-row">\n            <label for="clock-timezone">Timezone</label>\n            <select id="clock-timezone">\n                <option value="local" ${"local"!==t.settings.timezone&&t.settings.timezone?"":"selected"}>Local Time</option>\n                <option value="America/New_York" ${"America/New_York"===t.settings.timezone?"selected":""}>New York (EST/EDT)</option>\n                <option value="America/Los_Angeles" ${"America/Los_Angeles"===t.settings.timezone?"selected":""}>Los Angeles (PST/PDT)</option>\n                <option value="Europe/London" ${"Europe/London"===t.settings.timezone?"selected":""}>London (GMT/BST)</option>\n                <option value="Europe/Paris" ${"Europe/Paris"===t.settings.timezone?"selected":""}>Paris (CET/CEST)</option>\n                <option value="Asia/Tokyo" ${"Asia/Tokyo"===t.settings.timezone?"selected":""}>Tokyo (JST)</option>\n            </select>\n        </div>\n    `;n&&(o+=`\n            <div class="settings-row">\n                <label for="clock-format">Time Format</label>\n                <select id="clock-format">\n                    <option value="24h" ${"24h"!==t.settings.timeFormat&&t.settings.timeFormat?"":"selected"}>24-hour</option>\n                    <option value="12h" ${"12h"===t.settings.timeFormat?"selected":""}>12-hour (AM/PM)</option>\n                </select>\n            </div>\n            \n            <div class="settings-row">\n                <div class="checkbox-group">\n                    <input type="checkbox" id="show-seconds" ${!1!==t.settings.showSeconds?"checked":""}>\n                    <label for="show-seconds">Show seconds</label>\n                </div>\n            </div>\n            \n            <div class="settings-row">\n                <div class="checkbox-group">\n                    <input type="checkbox" id="show-date" ${!1!==t.settings.showDate?"checked":""}>\n                    <label for="show-date">Show date</label>\n                </div>\n            </div>\n        `),e.innerHTML=o;const r=document.createElement("style");r.textContent='\n        .widget-settings-form .settings-row {\n            margin-bottom: 15px;\n        }\n        \n        .widget-settings-form label {\n            display: block;\n            margin-bottom: 5px;\n            font-weight: bold;\n        }\n        \n        .widget-settings-form select {\n            width: 100%;\n            padding: 8px;\n            border: 1px solid #ddd;\n            border-radius: 4px;\n            font-size: 14px;\n        }\n        \n        .widget-settings-form .checkbox-group {\n            display: flex;\n            align-items: center;\n        }\n        \n        .widget-settings-form .checkbox-group input[type="checkbox"] {\n            margin-right: 10px;\n        }\n        \n        .widget-settings-form .checkbox-group label {\n            display: inline;\n            margin-bottom: 0;\n        }\n    ',document.head.appendChild(r)}function saveWidgetSettings(e,t){switch(e.widgetType){case"weather":const t=document.getElementById("weather-location").value.trim(),n=document.getElementById("weather-units").value;e.settings.location=t||"auto",e.settings.units=n;break;case"digital-clock":const o=document.getElementById("clock-format").value,r=document.getElementById("show-seconds").checked,i=document.getElementById("show-date").checked,s=document.getElementById("clock-timezone").value;e.settings.timeFormat=o,e.settings.showSeconds=r,e.settings.showDate=i,e.settings.timezone=s;break;case"analog-clock":const a=document.getElementById("clock-timezone").value;e.settings.timezone=a}}ruleOfThirdsOverlay.className="rule-of-thirds",document.body.appendChild(ruleOfThirdsOverlay),document.addEventListener("keydown",(function(e){e.altKey&&"g"===e.key&&document.body.classList.toggle("show-grid")})),toggleDragBtn.addEventListener("click",(()=>{dragEnabled=!dragEnabled,toggleDragBtn.innerHTML="<i>‚´ùÃ∏</i>",dragEnabled?(toggleDragBtn.classList.add("toggle-active"),ruleOfThirdsOverlay.style.display="block"):(toggleDragBtn.classList.remove("toggle-active"),ruleOfThirdsOverlay.style.display="none"),renderGroups()}));let editingAppIndex=-1;function openAppsManager(){document.getElementById("apps-manager-popup").style.display="flex",renderAppsList()}function renderAppsList(){const e=document.getElementById("apps-list-container");if(e.innerHTML="",!currentSettings.apps||0===currentSettings.apps.length){currentSettings.apps||(currentSettings.apps=[]);const t=document.createElement("div");return t.className="no-apps-message",t.textContent='No apps added yet. Click "Add App" to get started.',t.style.padding="16px",t.style.textAlign="center",void e.appendChild(t)}currentSettings.apps.forEach(((t,n)=>{const o=document.createElement("div");o.className="app-list-item";const r=document.createElement("img");r.src=t.icon||getFavicon(t.url),r.alt=t.name,r.className="app-list-icon";const i=document.createElement("div");i.className="app-list-details";const s=document.createElement("div");s.className="app-list-name",s.textContent=t.name;const a=document.createElement("div");a.className="app-list-url",a.textContent=t.url,i.appendChild(s),i.appendChild(a);const l=document.createElement("div");l.className="app-list-actions";const c=document.createElement("button");c.className="app-edit-btn",c.innerHTML="‚úé",c.title="Edit app",c.addEventListener("click",(()=>openAppEditor(n)));const d=document.createElement("button");d.className="app-move-up-btn",d.innerHTML="‚Üë",d.title="Move up",d.disabled=0===n,d.style.opacity=0===n?"0.5":"1",d.addEventListener("click",(()=>moveApp(n,-1)));const u=document.createElement("button");u.className="app-move-down-btn",u.innerHTML="‚Üì",u.title="Move down",u.disabled=n===currentSettings.apps.length-1,u.style.opacity=n===currentSettings.apps.length-1?"0.5":"1",u.addEventListener("click",(()=>moveApp(n,1)));const p=document.createElement("button");p.className="app-remove-btn",p.innerHTML="‚úï",p.title="Remove app",p.addEventListener("click",(()=>{confirm(`Are you sure you want to remove "${t.name}"?`)&&removeApp(n)})),l.appendChild(d),l.appendChild(u),l.appendChild(c),l.appendChild(p),o.appendChild(r),o.appendChild(i),o.appendChild(l),e.appendChild(o)}))}function moveApp(e,t){const n=e+t;if(n<0||n>=currentSettings.apps.length)return;const o=currentSettings.apps[e];currentSettings.apps[e]=currentSettings.apps[n],currentSettings.apps[n]=o,renderAppsList()}function removeApp(e){currentSettings.apps.splice(e,1),renderAppsList()}function openAppEditor(e=-1){document.getElementById("app-edit-popup").style.display="flex";const t=document.getElementById("app-name"),n=document.getElementById("app-url"),o=document.getElementById("app-icon");if(editingAppIndex=e,e>=0&&e<currentSettings.apps.length){const r=currentSettings.apps[e];t.value=r.name||"",n.value=r.url||"",o.value=r.icon||""}else t.value="",n.value="",o.value=""}function saveAppChanges(){const e=document.getElementById("app-name"),t=document.getElementById("app-url"),n=document.getElementById("app-icon"),o=e.value.trim(),r=t.value.trim(),i=n.value.trim()||getFavicon(r);if(!o)return void alert("Please enter an app name");if(!r)return void alert("Please enter a URL");let s=r;s.startsWith("http://")||s.startsWith("https://")||(s="https://"+s);const a={name:o,url:s,icon:i||getFavicon(s)};editingAppIndex>=0&&editingAppIndex<currentSettings.apps.length?currentSettings.apps[editingAppIndex]=a:(currentSettings.apps||(currentSettings.apps=[]),currentSettings.apps.push(a)),document.getElementById("app-edit-popup").style.display="none",renderAppsList()}let editingHeaderLinkIndex=-1;function openHeaderEditor(){document.getElementById("header-editor-popup").style.display="flex",renderHeaderLinksList()}function renderHeaderLinksList(){const e=document.getElementById("header-links-container");if(e.innerHTML="",!currentSettings.headerLinks||0===currentSettings.headerLinks.length){currentSettings.headerLinks||(currentSettings.headerLinks=[]);const t=document.createElement("div");return t.className="no-links-message",t.textContent='No header links added yet. Click "Add Link" to get started.',t.style.padding="16px",t.style.textAlign="center",void e.appendChild(t)}currentSettings.headerLinks.forEach(((t,n)=>{const o=document.createElement("div");o.className="header-link-item";const r=document.createElement("div");r.className="app-list-details";const i=document.createElement("div");i.className="app-list-name",i.textContent=t.name;const s=document.createElement("div");s.className="app-list-url",s.textContent=t.url,r.appendChild(i),r.appendChild(s);const a=document.createElement("div");a.className="app-list-actions";const l=document.createElement("button");l.className="app-edit-btn",l.innerHTML="‚úé",l.title="Edit link",l.addEventListener("click",(()=>openHeaderLinkEditor(n)));const c=document.createElement("button");c.className="app-move-up-btn",c.innerHTML="‚Üë",c.title="Move up",c.disabled=0===n,c.style.opacity=0===n?"0.5":"1",c.addEventListener("click",(()=>moveHeaderLink(n,-1)));const d=document.createElement("button");d.className="app-move-down-btn",d.innerHTML="‚Üì",d.title="Move down",d.disabled=n===currentSettings.headerLinks.length-1,d.style.opacity=n===currentSettings.headerLinks.length-1?"0.5":"1",d.addEventListener("click",(()=>moveHeaderLink(n,1)));const u=document.createElement("button");u.className="app-remove-btn",u.innerHTML="‚úï",u.title="Remove link",u.addEventListener("click",(()=>{confirm(`Are you sure you want to remove "${t.name}"?`)&&removeHeaderLink(n)})),a.appendChild(c),a.appendChild(d),a.appendChild(l),a.appendChild(u),o.appendChild(r),o.appendChild(a),e.appendChild(o)}))}function moveHeaderLink(e,t){const n=e+t;if(n<0||n>=currentSettings.headerLinks.length)return;const o=currentSettings.headerLinks[e];currentSettings.headerLinks[e]=currentSettings.headerLinks[n],currentSettings.headerLinks[n]=o,renderHeaderLinksList()}function removeHeaderLink(e){currentSettings.headerLinks.splice(e,1),renderHeaderLinksList()}function openHeaderLinkEditor(e=-1){document.getElementById("header-link-edit-popup").style.display="flex";const t=document.getElementById("header-link-name"),n=document.getElementById("header-link-url");if(editingHeaderLinkIndex=e,e>=0&&e<currentSettings.headerLinks.length){const o=currentSettings.headerLinks[e];t.value=o.name||"",n.value=o.url||""}else t.value="",n.value=""}function saveHeaderLinkChanges(){const e=document.getElementById("header-link-name"),t=document.getElementById("header-link-url"),n=e.value.trim(),o=t.value.trim();if(!n)return void alert("Please enter a link name");if(!o)return void alert("Please enter a URL");let r=o;r.startsWith("http://")||r.startsWith("https://")||(r="https://"+r);const i={name:n,url:r};editingHeaderLinkIndex>=0&&editingHeaderLinkIndex<currentSettings.headerLinks.length?currentSettings.headerLinks[editingHeaderLinkIndex]=i:(currentSettings.headerLinks||(currentSettings.headerLinks=[]),currentSettings.headerLinks.push(i)),document.getElementById("header-link-edit-popup").style.display="none",renderHeaderLinksList()}function fixUrl(e){return e?/^https?:\/\//i.test(e)?e:(/^www\./i.test(e),"https://"+e):""}function sanitizeGroupLinks(e){return e.map((e=>(Array.isArray(e.links)&&(e.links=e.links.map((e=>({...e,url:fixUrl(e.url)})))),e)))}async function saveGroupsToStorage(){const e=sanitizeGroupLinks(currentGroups);"undefined"!=typeof chrome&&chrome.storage?await chrome.storage.sync.set({groups:e}):localStorage.setItem("groups",JSON.stringify(e)),currentGroups=e}document.addEventListener("DOMContentLoaded",(function(){applyThemeToEditor();const e=document.getElementById("edit-header-btn");e&&e.addEventListener("click",(function(){openHeaderEditor()}));const t=document.getElementById("cancel-header-btn"),n=document.getElementById("save-header-btn"),o=document.getElementById("add-header-link-btn");t&&t.addEventListener("click",(function(){document.getElementById("header-editor-popup").style.display="none"})),n&&n.addEventListener("click",(function(){document.getElementById("header-editor-popup").style.display="none"})),o&&o.addEventListener("click",(function(){openHeaderLinkEditor()}));const r=document.getElementById("cancel-header-link-edit-btn"),i=document.getElementById("save-header-link-edit-btn");r&&r.addEventListener("click",(function(){document.getElementById("header-link-edit-popup").style.display="none"})),i&&i.addEventListener("click",saveHeaderLinkChanges);const s=document.getElementById("cancel-apps-btn"),a=document.getElementById("save-apps-btn"),l=document.getElementById("add-app-btn");s&&s.addEventListener("click",(function(){document.getElementById("apps-manager-popup").style.display="none"})),a&&a.addEventListener("click",(function(){document.getElementById("apps-manager-popup").style.display="none"})),l&&l.addEventListener("click",(function(){openAppEditor()}));const c=document.getElementById("cancel-app-edit-btn"),d=document.getElementById("save-app-edit-btn");c&&c.addEventListener("click",(function(){document.getElementById("app-edit-popup").style.display="none"})),d&&d.addEventListener("click",saveAppChanges)}));